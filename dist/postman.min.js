!function(){function t(t){t=t||{},this.id=t.id||i(),this.type=t.type,this.name=t.name,this.error=t.error,this.payload=t.payload}function e(t,e,n){this.id=i(),this.contentWindow=t,this.domain=e,this.handlers={},this.timeoutDuration=n,this.timeoutDuration||0===this.timeoutDuration||(this.timeoutDuration=1e4),this.callbacks={},this.timeoutHandlers={},r[this.id]=this}function i(t){var e="23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghkmnpqrstuvwxyz",i="";t=t||6;for(var n=0;n<t;n++){var r=Math.floor(Math.random()*e.length);i+=e.substring(r,r+1)}return i}var n={},r={};n.createClient=function(t,i,n){return new e(t,i,n)},n.getClientsByWindow=function(t){var e=[];for(var i in r)r[i].contentWindow==t&&e.push(r[i]);return e},t.create=function(e){return new t(e||{})},t.parse=function(e){var i=JSON.parse(e.data);return new t(i)},t.prototype.toJSON=function(){var t={id:this.id,type:this.type,name:this.name,error:this.error,payload:this.payload};return JSON.stringify(t)},e.prototype.sendMessage=function(t){this.contentWindow.postMessage(t.toJSON(),this.domain)},e.prototype.emit=function(e,i,n,r){var a=this,o=t.create({type:"req",name:e,payload:i});if(n){this.callbacks[o.id]=n;var s=isNaN(Number(r))?this.timeoutDuration:Number(r);s>0&&(this.timeoutHandlers[o.id]=setTimeout(function(){var t=a.callbacks[o.id];t&&t(new Error("Timeout exceed.")),delete a.callbacks[o.id],delete a.timeoutHandlers[o.id]},s))}this.sendMessage(o)},e.prototype.on=function(t,e){this.handlers[t]=e},e.prototype.handleRequest=function(e){var i=this,n=this.handlers[e.name];if(n){var r=function(n,r){var a=t.create({id:e.id,name:e.name,type:"res",error:n,payload:r});i.sendMessage(a)};n&&n(e.payload,r)}},e.prototype.handleResponse=function(t){var e=this.callbacks[t.id];e&&e(t.error,t.payload),this.timeoutHandlers[t.id]&&clearTimeout(this.timeoutHandlers[t.id]),delete this.callbacks[t.id]},e.prototype.destroy=function(){for(var t in this.timeoutHandlers)clearTimeout(this.timeoutHandlers[t]);for(var t in this.callbacks)this.callbacks[t](new Error("Postman client has destoyed."));delete r[this.id]},window.addEventListener("message",function(e){try{var i=t.parse(e),r=n.getClientsByWindow(e.source);if(!r||0==r.length)return;for(var a=0;a<r.length;a++){var o=r[a];switch(i.type){case"req":o.handleRequest(i);break;case"res":o.handleResponse(i)}}}catch(s){}},!1),"undefined"!=typeof module&&(module.exports=n),"undefined"!=typeof window&&(window.postman=n)}();